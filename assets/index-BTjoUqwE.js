const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-export-CtJ6pU_p.js","assets/vendor-react-BY1kz5vD.js"])))=>i.map(i=>d[i]);
import{r as m,j as e,C as V,D as W,a as B,b as I,A as X,M as q,I as G,F as J,d as Y}from"./vendor-react-BY1kz5vD.js";import{_}from"./vendor-export-CtJ6pU_p.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const d of t.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(a){if(a.ep)return;a.ep=!0;const t=r(a);fetch(a.href,t)}})();function Z({paragraph:n,setParagraph:i}){const r=m.useRef(null);m.useEffect(()=>{if(r.current){r.current.style.height="auto";const t=r.current.scrollHeight;r.current.style.height=`${t}px`}},[n]);const o=()=>{const t=["今日は朝から猫がベランダで日向ぼっこしていたので、つい一緒にゴロゴロしてしまった。","近所のパン屋さんで新作のメロンパンを買ったら、予想以上にサクサクで感動した。","図書館で偶然見つけた本が面白すぎて、気づいたら3時間も経っていた。","雨の中を歩いていたら、傘を持っていない猫と目が合って、思わず傘を貸したくなった。"],d=t[Math.floor(Math.random()*t.length)];i(d)},a=async()=>{try{const t=await navigator.clipboard.readText();t&&i(t)}catch(t){console.error("Failed to read clipboard contents: ",t)}};return e.jsxs("section",{className:"input-section",children:[e.jsx("textarea",{ref:r,className:"input-area",value:n,onChange:t=>i(t.target.value),placeholder:"文章を入力...",style:{minHeight:"100%"}}),e.jsxs("div",{className:"input-actions",children:[!n&&e.jsx("button",{className:"paste-button",onClick:a,title:"ペースト",children:e.jsx(V,{size:20})}),e.jsx("button",{className:"generate-button",onClick:o,title:"ランダムな文章を生成",children:e.jsx(W,{size:20})})]})]})}function Q(){return e.jsx("header",{className:"nav",children:e.jsxs("a",{className:"nav-title",href:"#main",children:[e.jsx("img",{className:"logo",src:"images/logo.png",alt:"Logo"}),e.jsx("span",{className:"title",children:"せっさたくま"})]})})}const E=" ";function S({text:n,accent:i,onUpdate:r,editable:o=!1}){const[a,t]=m.useState(o),d=["none","flat","drop"],y=g=>{const h=g.target;r==null||r(h.innerText,(i+1-(a?1:0))%3),t(!1)},j=g=>{if(!o)return;const h=g.target;r==null||r(h.innerText,i),t(!0)},b=g=>{const h=g.target;g.key==="Backspace"&&h.innerText.length<=1&&(h.innerText=E),g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),h.innerText.length==0&&(h.innerText=E),h.blur())};return e.jsx("span",{className:`kana ${i?`accent-${d[i]}`:""} ${o?"furigana":""}`,onClick:y,contentEditable:o,suppressContentEditableWarning:!0,onBlur:j,onKeyDown:b,children:n})}function U({lines:n=3,className:i=""}){const r=m.useMemo(()=>Array.from({length:n},()=>`${Math.random()*40+60}%`),[n]);return e.jsx("div",{className:`skeleton-container ${i}`,children:Array.from({length:n}).map((o,a)=>e.jsx("div",{className:"skeleton-line",style:{width:r[a]}},a))})}function C(n){return/^[ぁ-んァ-ンー\u3000、。・「」『』（）《》【】！？：；—…‥〜A-Za-z]+$/.test(n)}function M(n){const i="ゃゅょァィゥェォャュョヮぁぃぅぇぉっッ",r=[];for(let o=0;o<n.length;o++){const a=n[o],t=n[o+1];t&&i.includes(t)?(r.push(a+t),o++):r.push(a)}return r}const D=(()=>{let n=null;return()=>n??(n=Promise.all([_(()=>import("./vendor-export-CtJ6pU_p.js").then(i=>i.i),__vite__mapDeps([0,1])),_(()=>import("./vendor-export-CtJ6pU_p.js").then(i=>i.j),__vite__mapDeps([0,1]))]).then(([i,r])=>({toPng:i.toPng,jsPDF:r.default})))})(),O=m.forwardRef(({words:n,setWords:i,isLoading:r},o)=>{const[a,t]=m.useState(null),[d,y]=m.useState("success"),[j,b]=m.useState(!1),g=m.useRef(null),h=()=>{if(!n||n.length===0)return;const c=n.map(s=>{const u=s.surface;if(C(u)){const f=Array.isArray(s.furigana)?s.furigana:[];return[...u].map((p,x)=>{var T;const v=((T=f[x])==null?void 0:T.accent)??(Array.isArray(s.accent)?s.accent[x]:0)??0;return v===1?`<i>${p}</i>`:v===2?`<b>${p}</b>`:p}).join("")}const l=Array.isArray(s.furigana)?s.furigana.map(f=>f.accent===1?`<i>${f.text}</i>`:f.accent===2?`<b>${f.text}</b>`:f.text).join(""):"";return`{${u}|${l}}`}).join("").replace(/<\/b><b>/g,"").replace(/<\/i><i>/g,"");navigator.clipboard.writeText(c).then(()=>{y("success"),t("HackMD形式でコピーしました！"),setTimeout(()=>{t(null)},2e3)}).catch(s=>{console.error("コピー失敗",s),y("warning"),t("コピーに失敗しました"),setTimeout(()=>t(null),2e3)})},k=async()=>{if(g.current===null||n.length===0)return;const c=j?"#1F2937":"#FFFFFF",{toPng:s}=await D();s(g.current,{backgroundColor:c,pixelRatio:2}).then(u=>{const l=document.createElement("a");l.download="accented-text.png",l.href=u,l.click()}).catch(u=>{console.error("画像の生成に失敗しました",u)})},N=async()=>{if(g.current===null||n.length===0)return;const c=j?"#1F2937":"#FFFFFF",s=g.current,u=40,l=s.offsetWidth+u,f=s.offsetHeight+u,{toPng:p,jsPDF:x}=await D();p(s,{backgroundColor:c,pixelRatio:2,width:l,height:f,style:{padding:"20px",boxSizing:"border-box"}}).then(v=>{const T=l>f?"landscape":"portrait",R=new x({orientation:T,unit:"px",format:[l,f]});R.addImage(v,"PNG",0,0,l,f),R.save("accented-text.pdf")}).catch(v=>{console.error("PDFの生成に失敗しました",v)})},K=(c,s,u)=>{const l=[...n];Array.isArray(l[c].accent)&&(l[c].accent[s]=u),i(l)},z=(c,s,u,l)=>{const f=[...n];u===E?f[c].furigana.length===1?(f[c].furigana[s].text=E,f[c].furigana[s].accent=0):f[c].furigana.splice(s,1):M(u).length===1&&(f[c].furigana[s].text=u,f[c].furigana[s].accent=l),i(f)};let $;r?$=e.jsx(U,{lines:5}):!n||n.length===0?$=e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"結果"})}):$=e.jsx("p",{className:"result-area",ref:g,children:n.map((c,s)=>e.jsxs("ruby",{children:[[...c.surface].map((u,l)=>Array.isArray(c.accent)?e.jsx(S,{text:u,accent:c.accent[l],onUpdate:(f,p)=>K(s,l,p)},`${s}-${l}`):e.jsx("span",{children:u},`${s}-${l}`)),e.jsx("rt",{children:[...c.furigana].map((u,l)=>e.jsx(S,{editable:!0,text:C(c.surface)?"":u.text,accent:C(c.surface)?0:u.accent,onUpdate:(f,p)=>z(s,l,f,p)},`${s}-${l}`))})]},`${s}-${c.surface}`))});const[A,F]=m.useState(!1),P=!n||n.length===0;m.useEffect(()=>{P||D()},[P]),m.useEffect(()=>{if(!A)return;const c=s=>{s.target.closest(".save-menu-container")||F(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[A]);const H=()=>{if(!n||n.length===0)return;const c=n.map(s=>{const u=s.surface;let l=0,f=-1;if(Array.isArray(s.furigana)&&s.furigana.length>0){f=s.furigana.findIndex(x=>x.accent===2),f!==-1&&(l=f+1);const p=s.furigana.map(x=>x.text).join("");return u===p?`${u}（${l}）`:`${u}（${p}｜${l}）`}else{if(Array.isArray(s.accent)){const p=s.accent.findIndex(x=>x===2);p!==-1&&(l=p+1)}return`${u}（${l}）`}}).join("");navigator.clipboard.writeText(c).then(()=>{y("success"),t("コピーしました！"),setTimeout(()=>{t(null)},2e3)}).catch(s=>{console.error("コピー失敗",s),y("warning"),t("コピーに失敗しました"),setTimeout(()=>t(null),2e3)})};return e.jsxs("div",{className:`result-container-inner ${j?"dark-result":""} ${P?"tone-down":""}`,ref:o,children:[e.jsx("div",{className:"result-content",children:$}),!P&&e.jsxs("div",{className:"result-actions",children:[e.jsxs("div",{className:"action-group-left",children:[a&&e.jsx("div",{className:`toast-notification toast-${d}`,children:a}),e.jsx("button",{className:"action-button",onClick:H,title:"テキスト形式でコピー",children:e.jsx(B,{size:18})}),e.jsx("button",{className:"action-button",onClick:h,title:"HackMD形式でコピー (カスタムレンダリング用)",children:e.jsx(I,{size:18})})]}),e.jsxs("div",{className:"save-menu-container",children:[e.jsx("button",{className:`action-button save-menu-trigger ${A?"active":""}`,onClick:()=>F(c=>!c),title:"保存オプション",children:e.jsx(X,{size:18})}),A&&e.jsxs("div",{className:"save-menu-dropdown",children:[e.jsxs("div",{className:"theme-switch-container",children:[e.jsx(q,{size:16,className:"theme-switch-label"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:()=>b(c=>!c)}),e.jsx("span",{className:"slider"})]})]}),e.jsx("div",{className:"menu-divider"}),e.jsxs("button",{className:"menu-item",onClick:()=>{k(),F(!1)},children:[e.jsx(G,{size:16}),e.jsx("span",{children:"画像"})]}),e.jsxs("button",{className:"menu-item",onClick:()=>{N(),F(!1)},children:[e.jsx(J,{size:16}),e.jsx("span",{children:"PDF"})]})]})]})]})]})});O.displayName="Result";async function w(n){try{const r=await fetch("https://api.sessatakuma.dev/api/MarkAccent/",{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":""},body:JSON.stringify({text:n})}),o=await r.json();return r.ok&&o.status===200&&Array.isArray(o.result)?o.result.map(a=>{let t=a.furigana;return C(a.surface)?t="":t=M(t),{surface:a.surface,furigana:t,accent:a.accent}}):(console.error("API format error:",o),[])}catch(r){return console.error("API error:",r),[]}}function ee(n,i){const[r,o]=m.useState(n);return m.useEffect(()=>{const a=setTimeout(()=>{o(n)},i);return()=>{clearTimeout(a)}},[n,i]),r}function te(){const[n,i]=m.useState(""),[r,o]=m.useState([]),[a,t]=m.useState(!1),d=ee(n,800),y=m.useRef(null),j=m.useCallback(async b=>{if(!b||b.trim()===""){o([]);return}t(!0);const g=await w(b);if(g.length>0)o(g.map(h=>{const k=h.furigana.length===0;return{surface:h.surface,furigana:[...h.accent].map(N=>({text:N.furigana,accent:N.accent_marking_type})),accent:k?[...h.accent].map(N=>N.accent_marking_type):0}}));else{alert("サーバーからの応答がありませんでした。");const h=new Intl.Segmenter("ja",{granularity:"word"});o([...h.segment(b)].map(k=>({surface:k.segment,furigana:[{text:"",accent:0}],accent:0})))}t(!1)},[o,t]);return m.useEffect(()=>{j(d)},[d,j]),e.jsxs("div",{className:"app-container",children:[e.jsx(Q,{}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"two-col-layout",children:[e.jsx("section",{className:"input-panel",children:e.jsx(Z,{paragraph:n,setParagraph:i})}),e.jsx("section",{className:"result-panel",children:e.jsx(O,{words:r,setWords:o,ref:y,isLoading:a})})]})})]})}const L=document.getElementById("root");L&&Y.createRoot(L).render(e.jsx(te,{}));
